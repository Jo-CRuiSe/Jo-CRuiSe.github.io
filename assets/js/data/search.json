---
layout: compress
swcache: true
---

[
  {% assign public = site.posts | where: 'public', 'true' %}

  {% if page.dir == '/shelter/' or page.public == false %}
    {% for post in site.posts %}
    {
      "title": {{ post.title | jsonify }},
      "url": {{ post.url | relative_url | jsonify }},
      "categories": {{ post.categories | join: ', ' | jsonify }},
      "tags": {{ post.tags | join: ', ' | jsonify }},
      "date": "{{ post.date }}",
      {% include no-linenos.html content=post.content %}
      {% assign _content = content | strip_html | strip_newlines %}
      "snippet": {{ _content | truncate: 200 | jsonify }},
      "content": {{ _content | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  {% else %}
    {% for post in public %}
    {
      "title": {{ post.title | jsonify }},
      "url": {{ post.url | relative_url | jsonify }},
      "categories": {{ post.categories | join: ', ' | jsonify }},
      "tags": {{ post.tags | join: ', ' | jsonify }},
      "date": "{{ post.date }}",
      {% include no-linenos.html content=post.content %}
      {% assign _content = content | strip_html | strip_newlines %}
      "snippet": {{ _content | truncate: 200 | jsonify }},
      "content": {{ _content | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  {% endif %}
]
